// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace Tarea_8.Pages
{
    #line hidden
    using System;
    using System.Threading.Tasks;
#nullable restore
#line 2 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Tarea_8;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Tarea_8.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Radzen;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
using Microsoft.AspNetCore.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
using System.Collections.Generic;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
using Tarea_8.Modelos;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/registrar_vacuna")]
    public partial class Registrar_vacuna : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 121 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
                                                                              
    string cedula = "", nombre = "", apellido = "", telefono = "", fecha_nacimiento = "", signo_zodiaco = "", primeradosis = "", idvacuna = "", idprovincia = "", lat = "", lon = "";

    

#line default
#line hidden
#nullable disable
#nullable restore
#line 124 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
                                   
    string nombre_registrado = "", apellido_registrado = "", telefono_registrado = "", fecha_nacimiento_registrado = "", signo_zodiaco_registrado = "", primeradosis_registrado = "", idvacuna_registrado = "", idprovincia_registrado = "", lat_registrado = "", lon_registrado = "", segundadosis = "";

    //Campo para validar entrada
    bool validar;

    //Campo para mostrar que se ha ingresado con exito la persona
    int mensaje = 0;
    

#line default
#line hidden
#nullable disable
#nullable restore
#line 132 "C:\Users\User\Desktop\Programacion 3\Tarea-8\Tarea-8\Pages\Registrar-vacuna.razor"
                                                          
Data.DatosCedula padron = new Data.DatosCedula();
public List<inventario> GetInventarios() => new Contexto().Inventarios.ToList();
public List<provincia> GetProvincias() => new Contexto().Provincias.ToList();
public List<inventario> vacunas;
public List<provincia> provincias;

protected override void OnInitialized()
{
    vacunas = GetInventarios();
    provincias = GetProvincias();
}


public void DatosPersona()
{
    //Validando si la persona ingresada está en la bd
    using (Contexto context = new Contexto())
    {
        validar = context.Vacunadas.Any(ee => ee.Cedula == cedula);

        if (validar)
        {
            Vacunados va = context.Vacunadas
                        .Where(e => e.Cedula == cedula)
                        .FirstOrDefault();

            nombre_registrado = va.Nombre;
            apellido_registrado = va.Apellido;
            telefono_registrado = va.Telefono;
            fecha_nacimiento_registrado = va.Fecha_nacimiento;
            signo_zodiaco_registrado = va.signo_zodiaco;
            primeradosis_registrado = va.Fecha_Dosis1;
            idvacuna_registrado = va.Vacuna_recibida.ToString();
            idprovincia_registrado = va.Provincia.ToString();
            lat_registrado = va.Lat;
            lon_registrado = va.Lon;
        }

        else
        {
            //Asignando los valores a las variables creadas anteriormente
            var personaje = padron.Datos(cedula);
            nombre = personaje.Nombres;
            apellido = personaje.Apellido1 + " " + personaje.Apellido2;
            fecha_nacimiento = Convert.ToDateTime(personaje.FechaNacimiento).ToString("MM/dd/yyyy");
            int dia_zodiaco = int.Parse(Convert.ToDateTime(personaje.FechaNacimiento).ToString("dd"));
            int mes_zodiaco = int.Parse(Convert.ToDateTime(personaje.FechaNacimiento).ToString("MM"));
            signo_zodiaco = signo(dia_zodiaco, mes_zodiaco);
        }
    }
}

public void EnviarDatos()
{
    Modelos.Vacunados vacu = new Modelos.Vacunados();
    vacu.Cedula = cedula;
    vacu.Nombre = nombre;
    vacu.Apellido = apellido;
    vacu.Fecha_nacimiento = fecha_nacimiento;
    vacu.Telefono = telefono;
    vacu.signo_zodiaco = signo_zodiaco;
    vacu.Vacuna_recibida = int.Parse(idvacuna);
    vacu.Provincia = int.Parse(idprovincia);
    vacu.Fecha_Dosis1 = primeradosis;
    vacu.Lat = lat;
    vacu.Lon = lon;
    using (Contexto context = new Contexto())
    {
        var inventario = context.Inventarios.Find(int.Parse(idvacuna));
        inventario.cantidad = inventario.cantidad - 1;
        context.Add(vacu);
        context.SaveChanges();
    }

    mensaje = 1;

}

public void AplicarDosis()
{

    using (Contexto context = new Contexto())
    {
        Vacunados va = context.Vacunadas
                .Where(e => e.Cedula == cedula)
                .FirstOrDefault();

        var id = va.Id;
        var vacunados = context.Vacunadas.Find(id);
        vacunados.Fecha_Dosis2 = segundadosis;
        var inventario = context.Inventarios.Find(int.Parse(idvacuna_registrado));
        inventario.cantidad = inventario.cantidad - 1;

        context.SaveChanges();
    }

    mensaje = 1;

}

public string signo(int dia, int mes)
{
    if ((dia >= 21 && mes == 3) || (dia <= 20 && mes == 4))
        return "Aries";

    if ((dia >= 24 && mes == 9) || (dia <= 23 && mes == 10))
        return "Libra";

    if ((dia >= 21 && mes == 4) || (dia <= 21 && mes == 5))
        return "Tauro";

    if ((dia >= 24 && mes == 10) || (dia <= 22 && mes == 11))
        return "Escorpio";

    if ((dia >= 22 && mes == 5) || (dia <= 21 && mes == 6))
        return "Géminis";

    if ((dia >= 23 && mes == 11) || (dia <= 21 && mes == 12))
        return "Sagitario";

    if ((dia >= 21 && mes == 6) || (dia <= 23 && mes == 7))
        return "Cáncer";

    if ((dia >= 22 && mes == 12) || (dia <= 20 && mes == 1))
        return "Capricornio";

    if ((dia >= 24 && mes == 7) || (dia <= 23 && mes == 8))
        return "Leo";

    if ((dia >= 21 && mes == 1) || (dia <= 19 && mes == 2))
        return "Acuario";

    if ((dia >= 24 && mes == 8) || (dia <= 23 && mes == 9))
        return "Virgo";

    if ((dia >= 20 && mes == 2) || (dia <= 20 && mes == 3))
        return "Piscis";

    return "";
}


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient Http { get; set; }
    }
}
#pragma warning restore 1591
